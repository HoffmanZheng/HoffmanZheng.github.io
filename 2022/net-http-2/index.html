<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="Chenghao.Zheng">
  
  
  
  <link rel="prev" href="https://hoffmanzheng.github.io/2022/code-refactor/" />
  
  <link rel="canonical" href="https://hoffmanzheng.github.io/2022/net-http-2/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           HTTP/2：漫谈 RFC 7540 | 人间一场大梦
       
  </title>
  <meta name="title" content="HTTP/2：漫谈 RFC 7540 | 人间一场大梦">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/hoffmanzheng.github.io\/"
    },
    "articleSection" : "posts",
    "name" : "HTTP\/2：漫谈 RFC 7540",
    "headline" : "HTTP\/2：漫谈 RFC 7540",
    "description" : "HTTP\/2 在引入头部字段压缩和允许单连接并发交换后，使更加高效的网络资源使用和更低的接收延迟成为可能。同时也引入了从服务端到客户端的主动推送。本篇结合 RFC 7540 谈谈 HTTP version 2。\n前言 超文本传输协议是一个大获成功的协议，尽管如此，HTTP\/1.1 使用的基础传输却有着会对当下的 应用性能 造成不利影响的特性。具体地讲，HTTP\/1.0 只允许在单个 TCP 连接中处理一个请求，在 HTTP\/1.1 新增请求管道后，也只实现了部分的并发请求，并仍遭受着头部阻塞。因此，HTTP\/1.0 和 HTTP\/1.1 的客户端为了实现并发并降低延迟，需要使用多个与服务端的连接来发送多个请求。此外，HTTP 头部字段经常是重复且冗余的，导致了不必要的网络流量，且拥塞窗口会被快速填充。这将在单个 TCP 连接处理多个请求时导致过度的延迟。\nHTTP\/2 通过在基础连接中定义一个更优的 HTTP 语义映射来处理这些问题。具体地，它允许在同个连接中多个请求和响应消息的交织，并对 HTTP 头部字段采用了高效的编码。它还支持请求的优先级，让一些更重要的请求能够更快地完成，以此来提升性能。生成的协议对网络更加友好，因为相比 HTTP\/1.x 只需使用更少的连接。这也意味着与其他流和长连接之间更少的竞争，反过来能更好地利用可用的网络容量。\nHTTP 2 协议概览 HTTP\/2 给 HTTP 语义提供了一个改良的传输，它支持 HTTP\/1.1 的所有核心特征，但旨在某些方面变得更加高效。HTTP\/2 的基础协议单元是一个框架 frame，每个框架类型服务一个不同的目的。例如，HEADERS 和 DATA 框架组成了 HTTP 请求和响应的基础，其他框架类型如 SETTINGS、WINDOW_UPDATE 和 PUSH_PROMISE 被用来支持 HTTP\/2 的其他特性。\n请求的多路复用通过让每个 HTTP 请求\/响应与它自己的流交换来实现。流是 各自独立 的，因此一个被阻塞的请求或响应不会阻止其他流的进程。流的控制和优先级使使用多路的流成为可能。流的控制保证了被接收者使用的数据被传输了。优先级保证了有限的资源能被首先引导至更重要的流上。\nHTTP\/2 增加了一个新的交互模式，借此一个服务可以向客户端推送响应。服务推送允许一个服务在权衡网络使用和潜在的延迟收益后，向客户端任意的发送（预计它将会需要的）数据。服务端通过合成一个发送 PUSH_PROMISE 框架的请求来完成这个。随后服务端就能在一个独立的流中给这个合成的请求发送一个响应。因为在连接中使用的 HTTP 头部字段可能包含了大量多余的数据，包含它们的框架可以被压缩。这对通常情况下的请求大小有着特殊的优势，且允许许多请求被压缩在一个包里。\nHTTP 2 连接 一个 HTTP\/2 连接是一个运行在 TCP 连接之上的应用层协议。客户端是 TCP 连接的初始化器。HTTP\/2 使用与 HTTP\/1.",
    "inLanguage" : "en-us",
    "author" : "Chenghao Zheng",
    "creator" : "Chenghao Zheng",
    "publisher": "Chenghao Zheng",
    "accountablePerson" : "Chenghao Zheng",
    "copyrightHolder" : "Chenghao Zheng",
    "copyrightYear" : "2022",
    "datePublished": "2022-11-09 13:19:47 \u002b0100 \u002b0100",
    "dateModified" : "2022-11-09 13:19:47 \u002b0100 \u002b0100",
    "url" : "https:\/\/hoffmanzheng.github.io\/2022\/net-http-2\/",
    "wordCount" : "184",
    "keywords" : [ "Net", "人间一场大梦"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    
        <div class="top-scroll-bar"></div>
    
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://hoffmanzheng.github.io/">人间一场大梦</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
    
        <div class="top-scroll-bar"></div>
    
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://hoffmanzheng.github.io/">人间一场大梦</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">HTTP/2：漫谈 RFC 7540</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://hoffmanzheng.github.io/" rel="author">Chenghao Zheng</a> with ♥ 
                <span class="post-time">
                on <time datetime=2022-11-09 itemprop="datePublished">November 9, 2022</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://hoffmanzheng.github.io/categories/reading-notes/"> Reading notes </a>
                        
                </span>
                 <span class="post-word-count">,184 words</span>
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          <p>HTTP/2 在引入头部字段压缩和允许单连接并发交换后，使更加高效的网络资源使用和更低的接收延迟成为可能。同时也引入了从服务端到客户端的主动推送。本篇结合 <a href="https://www.rfc-editor.org/rfc/rfc7540">RFC 7540</a> 谈谈 HTTP version 2。</p>
<h3 id="前言">前言</h3>
<p>超文本传输协议是一个大获成功的协议，尽管如此，HTTP/1.1 使用的基础传输却有着会对当下的 <strong>应用性能</strong> 造成不利影响的特性。具体地讲，HTTP/1.0 只允许在单个 TCP 连接中处理一个请求，在 HTTP/1.1 新增请求管道后，也只实现了部分的并发请求，并仍遭受着头部阻塞。因此，HTTP/1.0 和 HTTP/1.1 的客户端为了实现并发并降低延迟，需要使用多个与服务端的连接来发送多个请求。此外，HTTP 头部字段经常是重复且冗余的，导致了不必要的网络流量，且拥塞窗口会被快速填充。这将在单个 TCP 连接处理多个请求时导致过度的延迟。</p>
<p>HTTP/2 通过在基础连接中定义一个更优的 HTTP 语义映射来处理这些问题。具体地，它允许在同个连接中多个请求和响应消息的交织，并对 HTTP 头部字段采用了高效的编码。它还支持请求的优先级，让一些更重要的请求能够更快地完成，以此来提升性能。生成的协议对网络更加友好，因为相比 HTTP/1.x 只需使用更少的连接。这也意味着与其他流和长连接之间更少的竞争，反过来能更好地利用可用的网络容量。</p>
<h3 id="http-2-协议概览">HTTP 2 协议概览</h3>
<p>HTTP/2 给 HTTP 语义提供了一个改良的传输，它支持 HTTP/1.1 的所有核心特征，但旨在某些方面变得更加高效。HTTP/2 的基础协议单元是一个框架 <code>frame</code>，每个框架类型服务一个不同的目的。例如，<code>HEADERS</code> 和 <code>DATA</code> 框架组成了 HTTP 请求和响应的基础，其他框架类型如 <code>SETTINGS</code>、<code>WINDOW_UPDATE</code> 和 <code>PUSH_PROMISE</code> 被用来支持 HTTP/2 的其他特性。</p>
<p>请求的多路复用通过让每个 HTTP 请求/响应与它自己的流交换来实现。流是 <strong>各自独立</strong> 的，因此一个被阻塞的请求或响应不会阻止其他流的进程。流的控制和优先级使使用多路的流成为可能。流的控制保证了被接收者使用的数据被传输了。优先级保证了有限的资源能被首先引导至更重要的流上。</p>
<p>HTTP/2 增加了一个新的交互模式，借此一个服务可以向客户端推送响应。服务推送允许一个服务在权衡网络使用和潜在的延迟收益后，向客户端任意的发送（预计它将会需要的）数据。服务端通过合成一个发送 <code>PUSH_PROMISE</code> 框架的请求来完成这个。随后服务端就能在一个独立的流中给这个合成的请求发送一个响应。因为在连接中使用的 HTTP 头部字段可能包含了大量多余的数据，包含它们的框架可以被压缩。这对通常情况下的请求大小有着特殊的优势，且允许许多请求被压缩在一个包里。</p>
<h3 id="http-2-连接">HTTP 2 连接</h3>
<p>一个 HTTP/2 连接是一个运行在 TCP 连接之上的应用层协议。客户端是 TCP 连接的初始化器。HTTP/2 使用与 HTTP/1.1 相同的 http 和 https URI 框架。HTTP/2 共享着相同的默认端口，http URIs 80，https URIs 443。因此，对于目标资源比如 “http://example.org/foo” 或者 “https://example.com/bar” 的 URLs 的请求实现被要求首先判断（客户端希望立即与之建立连接的）上游服务是否支持 HTTP/2。</p>
<p>客户端可以在没有前置知识的情况下通过在 HTTP/1.1 请求中包含一个带有 h2c 令牌的升级头字段和一个 <code>HTTP2-Settings</code> 头字段来支持 HTTP/2。（基于 TLS 的 HTTP/2 使用 <code>h2</code> 作为协议标识符）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#a6e22e">GET</span> / <span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span>
Host<span style="color:#f92672">:</span> <span style="color:#ae81ff">Server.example.com</span>
Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">Upgrade, HTTP2-Settings</span>
Upgrade<span style="color:#f92672">:</span> <span style="color:#ae81ff">h2c</span>
HTTP2-Settings<span style="color:#f92672">:</span> <span style="color:#ae81ff">&lt;base64url encoding of HTTP/2 SETTINGS payload&gt;</span>
</code></pre></div><p>一个不支持 HTTP/2 的服务端能够在缺少升级头字段的情况下响应请求。而支持 HTTP/2 的服务会给出一个 101 交换协议的响应。在一个结束 101 响应的空行后，服务可以开始发送 HTTP/2 框架。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// 不支持 HTTP/2 的服务
</span><span style="color:#75715e"></span><span style="color:#a6e22e">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span> <span style="color:#ae81ff">200</span> <span style="color:#a6e22e">OK</span>
<span style="color:#a6e22e">Content</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Length</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">243</span>
<span style="color:#a6e22e">Content</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">text</span><span style="color:#f92672">/</span><span style="color:#a6e22e">html</span>
...

<span style="color:#75715e">// 支持 HTTP/2 的服务
</span><span style="color:#75715e"></span><span style="color:#a6e22e">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span> <span style="color:#ae81ff">101</span> <span style="color:#a6e22e">Switching</span> <span style="color:#a6e22e">Protocols</span>
<span style="color:#a6e22e">Connection</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Upgrade</span>
<span style="color:#a6e22e">Upgrade</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">h2c</span>

[ <span style="color:#a6e22e">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span> <span style="color:#a6e22e">connection</span> ... ]
</code></pre></div><p>这个提前发送来升级的请求会被认定为流 1，在 HTTP/2 连接开始后，流 1 会被用来作响应。因为升级只会应用在接下来的连接，客户端在发送 HTTP2-Settings 头字段时必须也发送 HTTP2-Settings 作为连接头字段的连接选项来防止请求被转发。</p>
<h3 id="http-框架">HTTP 框架</h3>
<h3 id="流与多路复用">流与多路复用</h3>
<h3 id="框架定义">框架定义</h3>
<h3 id="额外的-http-要求与考虑">额外的 HTTP 要求与考虑</h3>
<h3 id="安全性考虑">安全性考虑</h3>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>Chenghao.Zheng </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://hoffmanzheng.github.io/2022/net-http-2/>https://hoffmanzheng.github.io/2022/net-http-2/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                本文采用 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a> 进行许可
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://hoffmanzheng.github.io/tags/net/">
                    #Net</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://hoffmanzheng.github.io/">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://hoffmanzheng.github.io/2022/code-refactor/" class="prev" rel="prev" title="重构：改善既有代码的设计"><i class="iconfont icon-left"></i>&nbsp;重构：改善既有代码的设计</a>
         
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2019 - 2022</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://hoffmanzheng.github.io/">Chenghao.Zheng</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>













    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  



     </div>
  </body>
</html>
